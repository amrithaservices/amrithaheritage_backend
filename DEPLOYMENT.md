# Deployment Guide - Render Free Tier

## Prerequisites
- GitHub account with your code pushed
- Render account (free tier)
- Cloudinary account for media storage

## Step 1: Prepare Your Repository

1. **Add .env to .gitignore** (already done)
   - Never commit .env file to git
   - Use .env.example as template

2. **Commit and push changes:**
   ```bash
   git add .
   git commit -m "Production ready configuration"
   git push origin main
   ```

## Step 2: Deploy to Render

### Option A: Using render.yaml (Recommended)

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New" → "Blueprint"
3. Connect your GitHub repository
4. Render will automatically detect `render.yaml`
5. Add the following environment variables in Render Dashboard:
   - `CLOUDINARY_CLOUD_NAME`: Your Cloudinary cloud name
   - `CLOUDINARY_API_KEY`: Your Cloudinary API key
   - `CLOUDINARY_API_SECRET`: Your Cloudinary API secret
   - `DJANGO_SUPERUSER_USERNAME`: Your admin username
   - `DJANGO_SUPERUSER_PASSWORD`: Strong password for admin
   - `DJANGO_SUPERUSER_EMAIL`: Your admin email

6. Click "Apply" to deploy

### Option B: Manual Setup

#### Create PostgreSQL Database:
1. Go to Render Dashboard
2. Click "New" → "PostgreSQL"
3. Name: `amritha-heritage-db`
4. Plan: Free
5. Click "Create Database"
6. Copy the "Internal Database URL"

#### Create Web Service:
1. Click "New" → "Web Service"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `amritha-heritage-backend`
   - **Runtime**: Python 3
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn backend.wsgi --bind 0.0.0.0:$PORT`
   - **Plan**: Free

4. Add Environment Variables:
   ```
   SECRET_KEY=<auto-generated-by-render>
   DEBUG=False
   ALLOWED_HOSTS=.onrender.com,amrithaheritage.com,www.amrithaheritage.com
   DATABASE_URL=<paste-internal-database-url>
   CLOUDINARY_CLOUD_NAME=<your-value>
   CLOUDINARY_API_KEY=<your-value>
   CLOUDINARY_API_SECRET=<your-value>
   CORS_ALLOWED_ORIGINS=https://admin.amrithaheritage.com,https://www.amrithaheritage.com
   CSRF_TRUSTED_ORIGINS=https://admin.amrithaheritage.com,https://www.amrithaheritage.com
   DJANGO_SUPERUSER_USERNAME=admin
   DJANGO_SUPERUSER_PASSWORD=<strong-password>
   DJANGO_SUPERUSER_EMAIL=admin@amrithaheritage.com
   ```

5. Click "Create Web Service"

## Step 3: Post-Deployment

1. **Wait for deployment** (5-10 minutes for first deploy)

2. **Check deployment logs** for any errors

3. **Access admin panel:**
   - URL: `https://your-app.onrender.com/admin/`
   - Login with your DJANGO_SUPERUSER credentials

4. **Test API endpoints:**
   - Daily Specials: `https://your-app.onrender.com/api/menu/daily-specials/`
   - Active Specials: `https://your-app.onrender.com/api/menu/daily-specials/active/`

## Step 4: Custom Domain (Optional)

1. In Render Dashboard, go to your web service
2. Click "Settings" → "Custom Domain"
3. Add your domain: `api.amrithaheritage.com`
4. Update DNS records as instructed by Render
5. Update `ALLOWED_HOSTS` in environment variables

## Important Notes

### Free Tier Limitations:
- Database: 90 days expiry, 1GB storage
- Web service spins down after 15 minutes of inactivity
- First request after spin-down takes 30-60 seconds

### Security Checklist:
- ✅ SECRET_KEY is unique and not in git
- ✅ DEBUG=False in production
- ✅ .env file is gitignored
- ✅ Strong superuser password
- ✅ HTTPS enforced
- ✅ CORS properly configured

### Monitoring:
- Check Render logs for errors
- Monitor database usage (1GB limit)
- Set up uptime monitoring (e.g., UptimeRobot)

## Troubleshooting

### Build fails:
- Check build logs in Render Dashboard
- Ensure all dependencies in requirements.txt
- Verify Python version compatibility

### Database connection errors:
- Verify DATABASE_URL is set correctly
- Check database is running
- Ensure database and web service are in same region

### Static files not loading:
- Check `collectstatic` ran successfully in build logs
- Verify WhiteNoise is installed

### Superuser not created:
- Check environment variables are set
- Review build logs for errors
- Manually create via Render Shell if needed

## Support

For issues, check:
- Render Documentation: https://render.com/docs
- Django Documentation: https://docs.djangoproject.com/
- Project logs in Render Dashboard
